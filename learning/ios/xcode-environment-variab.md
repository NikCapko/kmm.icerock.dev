# Xcode - environment variables

Нужны для динамической конфигурации приложения. Например, подстановки защищенных данных в рантайме. На проекте со скринов ниже переменные окружения использовались в качестве конфигураторов для возможности подстановки моков.
Представляет из себя сет элементов вида ключ-значение. Советуется использовать их как read-only свойства.

_Важно знать про ограничение, что за работу с переменными окружения отвечает сам Xcode, поэтому, если приложение было установлено из AppStore/TestFlight, переменные окружения использованы не будут._

## Как добавить в проект

1. Заходим в редактирование схемы
![edit-scheme](https://user-images.githubusercontent.com/41479045/165701481-4c407896-b086-4ce3-823a-30334e66a533.png)
2. Переходим во вкладку "Test" - "Arguments"
![env-args](https://user-images.githubusercontent.com/41479045/165701508-6f2bb468-3fbc-4c1b-a16e-3ea496f72ad6.png)
3. Пример добавления "считывателей" переменных окружения по ключам. [ProcessInfo - набор информации о текущем процессе](https://developer.apple.com/documentation/foundation/processinfo)
![vars-reading](https://user-images.githubusercontent.com/41479045/165668898-6540b174-4db9-4302-b946-c338dff00381.png)
4. Пример использования. Так как в данном конкретном случае есть enum MockInfo, то используем считанные значения как булевый параметр
![usage-example](https://user-images.githubusercontent.com/41479045/165668963-61057ba7-13b8-484a-b36a-16132506a6e7.png)


## Предопределенные переменные окружения
В Xcode есть несколько предопределенных переменных, доступных для целей отладки.
Например:
* NSZombieEnabled - определяет, будет Foundation использовать зомби-объекты в рантайме. Должно помогать в отладке непонятного поведения, вызванного зомби-объектами. [Можно читнуть ссылку на эту тему](https://gist.github.com/JeOam/e62c95a0b4c21974bcf6)
* NSDeallocateZombies: определяет, должен ли Foundation освобождать все зомби-объекты.
* MallocGuardEdges: включает защиту памяти до и после буфера, чтобы мы могли отлавливать переполнения буфера.

[Интересная статья, которая может пояснить что такое зомби-объект](https://habr.com/ru/company/hh/blog/546856/)

Некоторые предопределенные переменные окружния можно настраивать через вкладку Diagnostics
![default-env-vars](https://user-images.githubusercontent.com/41479045/165701524-2468be45-d2e4-48b8-9405-8964d88efe9f.png)
